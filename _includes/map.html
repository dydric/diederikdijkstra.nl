<style>
#map {
  width: 100%;
  height: 1000px;
  max-height: 80vh;
}

.mapboxgl-ctrl {
  display: none;
}

.marker {
    border: none;
    border-radius: 50%;
    cursor: pointer;
    width: 60px;
    height: 60px;
    margin-left: -30px;
    margin-top: -30px;
}
</style>

<div id='map'></div>
<script>
  mapboxgl.accessToken = '{{ site.mapbox_token }}';

  var geojson = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "message": "TEST",
                "image": "https://placekitten.com/g/60"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    5.78966, 53.19126
                ]
            }
        }
    ]
  };

  var map = new mapboxgl.Map({
      container: 'map',
      style: '{{ site.mapbox_style }}',
      center: [5.78966, 53.19126],
      zoom: 10,
      minZoom: 9,
      maxZoom: 11,
      pitch: 40,
      trackResize: true,
      detectRetina: true
      // bearing: -60
  });

  map.on('load', function () {

    // // add markers to map
    // geojson.features.forEach(function(marker) {
    //   var el = document.createElement('div');
    //   el.className = 'marker';
    //   el.style.backgroundImage = 'url('+marker.properties.image+')';

    //   el.addEventListener('click', function() {
    //     window.alert(marker.properties.message);
    //   });

    //   // add marker to map
    //   new mapboxgl.Marker(el)
    //     .setLngLat(marker.geometry.coordinates)
    //     .addTo(map);
    // });

    {% for item in page.mapbox.routes %}
      map.addSource("route{{ forloop.index }}", {
        "type": "geojson",
        "data": {
          "type": "Feature",
          "properties": {},
          "geometry": {
            "type": "LineString",
            "coordinates": [{{item.route}}]
          }
        }
      });

      map.addLayer({
        "id": "route{{ forloop.index }}",
        "type": "line",
        "source": "route{{ forloop.index }}",
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "line-color": "{{item.color}}",
          "line-width": 4
        }
      });
    {% endfor %}


    // map.fitBounds([
    //   {% for item in page.mapbox.routes %}{% if forloop.first == false %},{% endif %}{{item.route}}{% endfor %}
    // ]);
  });

</script>





